{"version":3,"file":"focustrap.js","sources":["../../src/util/focustrap.js"],"sourcesContent":["/**\r\n * --------------------------------------------------------------------------\r\n * Bootstrap util/focustrap.js\r\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\r\n * --------------------------------------------------------------------------\r\n */\r\n\r\nimport EventHandler from '../dom/event-handler.js'\r\nimport SelectorEngine from '../dom/selector-engine.js'\r\nimport Config from './config.js'\r\n\r\n/**\r\n * Constants\r\n */\r\n\r\nconst NAME = 'focustrap'\r\nconst DATA_KEY = 'bs.focustrap'\r\nconst EVENT_KEY = `.${DATA_KEY}`\r\nconst EVENT_FOCUSIN = `focusin${EVENT_KEY}`\r\nconst EVENT_KEYDOWN_TAB = `keydown.tab${EVENT_KEY}`\r\n\r\nconst TAB_KEY = 'Tab'\r\nconst TAB_NAV_FORWARD = 'forward'\r\nconst TAB_NAV_BACKWARD = 'backward'\r\n\r\nconst Default = {\r\n  autofocus: true,\r\n  trapElement: null // The element to trap focus inside of\r\n}\r\n\r\nconst DefaultType = {\r\n  autofocus: 'boolean',\r\n  trapElement: 'element'\r\n}\r\n\r\n/**\r\n * Class definition\r\n */\r\n\r\nclass FocusTrap extends Config {\r\n  constructor(config) {\r\n    super()\r\n    this._config = this._getConfig(config)\r\n    this._isActive = false\r\n    this._lastTabNavDirection = null\r\n  }\r\n\r\n  // Getters\r\n  static get Default() {\r\n    return Default\r\n  }\r\n\r\n  static get DefaultType() {\r\n    return DefaultType\r\n  }\r\n\r\n  static get NAME() {\r\n    return NAME\r\n  }\r\n\r\n  // Public\r\n  activate() {\r\n    if (this._isActive) {\r\n      return\r\n    }\r\n\r\n    if (this._config.autofocus) {\r\n      this._config.trapElement.focus()\r\n    }\r\n\r\n    EventHandler.off(document, EVENT_KEY) // guard against infinite focus loop\r\n    EventHandler.on(document, EVENT_FOCUSIN, event =>\r\n      this._handleFocusin(event)\r\n    )\r\n    EventHandler.on(document, EVENT_KEYDOWN_TAB, event =>\r\n      this._handleKeydown(event)\r\n    )\r\n\r\n    this._isActive = true\r\n  }\r\n\r\n  deactivate() {\r\n    if (!this._isActive) {\r\n      return\r\n    }\r\n\r\n    this._isActive = false\r\n    EventHandler.off(document, EVENT_KEY)\r\n  }\r\n\r\n  // Private\r\n  _handleFocusin(event) {\r\n    const { trapElement } = this._config\r\n\r\n    if (\r\n      event.target === document ||\r\n      event.target === trapElement ||\r\n      trapElement.contains(event.target)\r\n    ) {\r\n      return\r\n    }\r\n\r\n    const elements = SelectorEngine.focusableChildren(trapElement)\r\n\r\n    if (elements.length === 0) {\r\n      trapElement.focus()\r\n    } else if (this._lastTabNavDirection === TAB_NAV_BACKWARD) {\r\n      elements[elements.length - 1].focus({ preventScroll: true })\r\n    } else {\r\n      elements[0].focus({ preventScroll: true })\r\n    }\r\n  }\r\n\r\n  _handleKeydown(event) {\r\n    if (event.key !== TAB_KEY) {\r\n      return\r\n    }\r\n\r\n    this._lastTabNavDirection = event.shiftKey ?\r\n      TAB_NAV_BACKWARD :\r\n      TAB_NAV_FORWARD\r\n  }\r\n}\r\n\r\nexport default FocusTrap\r\n"],"names":["NAME","DATA_KEY","EVENT_KEY","EVENT_FOCUSIN","EVENT_KEYDOWN_TAB","TAB_KEY","TAB_NAV_FORWARD","TAB_NAV_BACKWARD","Default","autofocus","trapElement","DefaultType","FocusTrap","Config","constructor","config","_config","_getConfig","_isActive","_lastTabNavDirection","activate","focus","EventHandler","off","document","on","event","_handleFocusin","_handleKeydown","deactivate","target","contains","elements","SelectorEngine","focusableChildren","length","preventScroll","key","shiftKey"],"mappings":"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"}