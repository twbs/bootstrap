{"version":3,"file":"strength.js","sources":["../src/strength.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Bootstrap strength.js\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport BaseComponent from './base-component.js'\nimport EventHandler from './dom/event-handler.js'\nimport SelectorEngine from './dom/selector-engine.js'\n\n/**\n * Constants\n */\n\nconst NAME = 'strength'\nconst DATA_KEY = 'bs.strength'\nconst EVENT_KEY = `.${DATA_KEY}`\nconst DATA_API_KEY = '.data-api'\n\nconst EVENT_STRENGTH_CHANGE = `strengthChange${EVENT_KEY}`\n\nconst SELECTOR_DATA_STRENGTH = '[data-bs-strength]'\n\nconst STRENGTH_LEVELS = ['weak', 'fair', 'good', 'strong']\n\nconst Default = {\n  input: null, // Selector or element for password input\n  minLength: 8,\n  messages: {\n    weak: 'Weak',\n    fair: 'Fair',\n    good: 'Good',\n    strong: 'Strong'\n  },\n  weights: {\n    minLength: 1,\n    extraLength: 1,\n    lowercase: 1,\n    uppercase: 1,\n    numbers: 1,\n    special: 1,\n    multipleSpecial: 1,\n    longPassword: 1\n  },\n  thresholds: [2, 4, 6], // weak ≤2, fair ≤4, good ≤6, strong >6\n  scorer: null // Custom scoring function (password) => number\n}\n\nconst DefaultType = {\n  input: '(string|element|null)',\n  minLength: 'number',\n  messages: 'object',\n  weights: 'object',\n  thresholds: 'array',\n  scorer: '(function|null)'\n}\n\n/**\n * Class definition\n */\n\nclass Strength extends BaseComponent {\n  constructor(element, config) {\n    super(element, config)\n\n    this._input = this._getInput()\n    this._segments = SelectorEngine.find('.strength-segment', this._element)\n    this._textElement = SelectorEngine.findOne('.strength-text', this._element.parentElement)\n    this._currentStrength = null\n\n    if (this._input) {\n      this._addEventListeners()\n      // Check initial value\n      this._evaluate()\n    }\n  }\n\n  // Getters\n  static get Default() {\n    return Default\n  }\n\n  static get DefaultType() {\n    return DefaultType\n  }\n\n  static get NAME() {\n    return NAME\n  }\n\n  // Public\n  getStrength() {\n    return this._currentStrength\n  }\n\n  evaluate() {\n    this._evaluate()\n  }\n\n  // Private\n  _getInput() {\n    if (this._config.input) {\n      return typeof this._config.input === 'string' ?\n        SelectorEngine.findOne(this._config.input) :\n        this._config.input\n    }\n\n    // Look for preceding password input\n    const parent = this._element.parentElement\n    return SelectorEngine.findOne('input[type=\"password\"]', parent)\n  }\n\n  _addEventListeners() {\n    EventHandler.on(this._input, 'input', () => this._evaluate())\n    EventHandler.on(this._input, 'change', () => this._evaluate())\n  }\n\n  _evaluate() {\n    const password = this._input.value\n    const score = this._calculateScore(password)\n    const strength = this._scoreToStrength(score)\n\n    if (strength !== this._currentStrength) {\n      this._currentStrength = strength\n      this._updateUI(strength, score)\n\n      EventHandler.trigger(this._element, EVENT_STRENGTH_CHANGE, {\n        strength,\n        score,\n        password: password.length > 0 ? '***' : '' // Don't expose actual password\n      })\n    }\n  }\n\n  _calculateScore(password) {\n    if (!password) {\n      return 0\n    }\n\n    // Use custom scorer if provided\n    if (typeof this._config.scorer === 'function') {\n      return this._config.scorer(password)\n    }\n\n    const { weights } = this._config\n    let score = 0\n\n    // Length scoring\n    if (password.length >= this._config.minLength) {\n      score += weights.minLength\n    }\n\n    if (password.length >= this._config.minLength + 4) {\n      score += weights.extraLength\n    }\n\n    // Character variety\n    if (/[a-z]/.test(password)) {\n      score += weights.lowercase\n    }\n\n    if (/[A-Z]/.test(password)) {\n      score += weights.uppercase\n    }\n\n    if (/\\d/.test(password)) {\n      score += weights.numbers\n    }\n\n    // Special characters\n    if (/[!@#$%^&*(),.?\":{}|<>]/.test(password)) {\n      score += weights.special\n    }\n\n    // Extra points for more special chars or length\n    if (/[!@#$%^&*(),.?\":{}|<>].*[!@#$%^&*(),.?\":{}|<>]/.test(password)) {\n      score += weights.multipleSpecial\n    }\n\n    if (password.length >= 16) {\n      score += weights.longPassword\n    }\n\n    return score\n  }\n\n  _scoreToStrength(score) {\n    if (score === 0) {\n      return null\n    }\n\n    const [weak, fair, good] = this._config.thresholds\n\n    if (score <= weak) {\n      return 'weak'\n    }\n\n    if (score <= fair) {\n      return 'fair'\n    }\n\n    if (score <= good) {\n      return 'good'\n    }\n\n    return 'strong'\n  }\n\n  _updateUI(strength) {\n    // Update data attribute on element\n    if (strength) {\n      this._element.dataset.bsStrength = strength\n    } else {\n      delete this._element.dataset.bsStrength\n    }\n\n    // Update segmented meter\n    const strengthIndex = strength ? STRENGTH_LEVELS.indexOf(strength) : -1\n\n    for (const [index, segment] of this._segments.entries()) {\n      if (index <= strengthIndex) {\n        segment.classList.add('active')\n      } else {\n        segment.classList.remove('active')\n      }\n    }\n\n    // Update text feedback\n    if (this._textElement) {\n      if (strength && this._config.messages[strength]) {\n        this._textElement.textContent = this._config.messages[strength]\n        this._textElement.dataset.bsStrength = strength\n\n        // Also set the color via inheriting from parent or using CSS variable\n        const colorMap = {\n          weak: 'danger',\n          fair: 'warning',\n          good: 'info',\n          strong: 'success'\n        }\n        this._textElement.style.setProperty('--strength-color', `var(--${colorMap[strength]}-text)`)\n      } else {\n        this._textElement.textContent = ''\n        delete this._textElement.dataset.bsStrength\n      }\n    }\n  }\n}\n\n/**\n * Data API implementation\n */\n\nEventHandler.on(document, `DOMContentLoaded${EVENT_KEY}${DATA_API_KEY}`, () => {\n  for (const element of SelectorEngine.find(SELECTOR_DATA_STRENGTH)) {\n    Strength.getOrCreateInstance(element)\n  }\n})\n\nexport default Strength\n"],"names":["NAME","DATA_KEY","EVENT_KEY","DATA_API_KEY","EVENT_STRENGTH_CHANGE","SELECTOR_DATA_STRENGTH","STRENGTH_LEVELS","Default","input","minLength","messages","weak","fair","good","strong","weights","extraLength","lowercase","uppercase","numbers","special","multipleSpecial","longPassword","thresholds","scorer","DefaultType","Strength","BaseComponent","constructor","element","config","_input","_getInput","_segments","SelectorEngine","find","_element","_textElement","findOne","parentElement","_currentStrength","_addEventListeners","_evaluate","getStrength","evaluate","_config","parent","EventHandler","on","password","value","score","_calculateScore","strength","_scoreToStrength","_updateUI","trigger","length","test","dataset","bsStrength","strengthIndex","indexOf","index","segment","entries","classList","add","remove","textContent","colorMap","style","setProperty","document","getOrCreateInstance"],"mappings":"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"}