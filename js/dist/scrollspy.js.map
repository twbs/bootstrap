{"version":3,"file":"scrollspy.js","sources":["../src/scrollspy.js"],"sourcesContent":["import $ from 'jquery'\nimport Util from './util'\n\n\n/**\n * --------------------------------------------------------------------------\n * Bootstrap (v4.0.0-beta): scrollspy.js\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n * --------------------------------------------------------------------------\n */\n\n\n/**\n * ------------------------------------------------------------------------\n * Constants\n * ------------------------------------------------------------------------\n */\n\nconst NAME               = 'scrollspy'\nconst VERSION            = '4.0.0-beta'\nconst DATA_KEY           = 'bs.scrollspy'\nconst EVENT_KEY          = `.${DATA_KEY}`\nconst DATA_API_KEY       = '.data-api'\nconst JQUERY_NO_CONFLICT = $.fn[NAME]\n\nconst Default = {\n  offset : 10,\n  method : 'auto',\n  target : ''\n}\n\nconst DefaultType = {\n  offset : 'number',\n  method : 'string',\n  target : '(string|element)'\n}\n\nconst Event = {\n  ACTIVATE      : `activate${EVENT_KEY}`,\n  SCROLL        : `scroll${EVENT_KEY}`,\n  LOAD_DATA_API : `load${EVENT_KEY}${DATA_API_KEY}`\n}\n\nconst ClassName = {\n  DROPDOWN_ITEM : 'dropdown-item',\n  DROPDOWN_MENU : 'dropdown-menu',\n  ACTIVE        : 'active'\n}\n\nconst Selector = {\n  DATA_SPY        : '[data-spy=\"scroll\"]',\n  ACTIVE          : '.active',\n  NAV_LIST_GROUP  : '.nav, .list-group',\n  NAV_LINKS       : '.nav-link',\n  LIST_ITEMS      : '.list-group-item',\n  DROPDOWN        : '.dropdown',\n  DROPDOWN_ITEMS  : '.dropdown-item',\n  DROPDOWN_TOGGLE : '.dropdown-toggle'\n}\n\nconst OffsetMethod = {\n  OFFSET   : 'offset',\n  POSITION : 'position'\n}\n\n/**\n * ------------------------------------------------------------------------\n * Class Definition\n * ------------------------------------------------------------------------\n */\n\nexport default class ScrollSpy {\n\n  constructor(element, config) {\n    this._element       = element\n    this._scrollElement = element.tagName === 'BODY' ? window : element\n    this._config        = this._getConfig(config)\n    this._selector      = `${this._config.target} ${Selector.NAV_LINKS},`\n                        + `${this._config.target} ${Selector.LIST_ITEMS},`\n                        + `${this._config.target} ${Selector.DROPDOWN_ITEMS}`\n    this._offsets       = []\n    this._targets       = []\n    this._activeTarget  = null\n    this._scrollHeight  = 0\n\n    $(this._scrollElement).on(Event.SCROLL, (event) => this._process(event))\n\n    this.refresh()\n    this._process()\n  }\n\n  // getters\n\n  static get VERSION() {\n    return VERSION\n  }\n\n  static get Default() {\n    return Default\n  }\n\n\n  // public\n\n  refresh() {\n    const autoMethod = this._scrollElement !== this._scrollElement.window ?\n      OffsetMethod.POSITION : OffsetMethod.OFFSET\n\n    const offsetMethod = this._config.method === 'auto' ?\n      autoMethod : this._config.method\n\n    const offsetBase = offsetMethod === OffsetMethod.POSITION ?\n      this._getScrollTop() : 0\n\n    this._offsets = []\n    this._targets = []\n\n    this._scrollHeight = this._getScrollHeight()\n\n    const targets = $.makeArray($(this._selector))\n\n    targets\n      .map((element) => {\n        let target\n        const targetSelector = Util.getSelectorFromElement(element)\n\n        if (targetSelector) {\n          target = $(targetSelector)[0]\n        }\n\n        if (target) {\n          const targetBCR = target.getBoundingClientRect()\n          if (targetBCR.width || targetBCR.height) {\n            // todo (fat): remove sketch reliance on jQuery position/offset\n            return [\n              $(target)[offsetMethod]().top + offsetBase,\n              targetSelector\n            ]\n          }\n        }\n        return null\n      })\n      .filter((item)  => item)\n      .sort((a, b)    => a[0] - b[0])\n      .forEach((item) => {\n        this._offsets.push(item[0])\n        this._targets.push(item[1])\n      })\n  }\n\n  dispose() {\n    $.removeData(this._element, DATA_KEY)\n    $(this._scrollElement).off(EVENT_KEY)\n\n    this._element       = null\n    this._scrollElement = null\n    this._config        = null\n    this._selector      = null\n    this._offsets       = null\n    this._targets       = null\n    this._activeTarget  = null\n    this._scrollHeight  = null\n  }\n\n\n  // private\n\n  _getConfig(config) {\n    config = $.extend({}, Default, config)\n\n    if (typeof config.target !== 'string') {\n      let id = $(config.target).attr('id')\n      if (!id) {\n        id = Util.getUID(NAME)\n        $(config.target).attr('id', id)\n      }\n      config.target = `#${id}`\n    }\n\n    Util.typeCheckConfig(NAME, config, DefaultType)\n\n    return config\n  }\n\n  _getScrollTop() {\n    return this._scrollElement === window ?\n        this._scrollElement.pageYOffset : this._scrollElement.scrollTop\n  }\n\n  _getScrollHeight() {\n    return this._scrollElement.scrollHeight || Math.max(\n      document.body.scrollHeight,\n      document.documentElement.scrollHeight\n    )\n  }\n\n  _getOffsetHeight() {\n    return this._scrollElement === window ?\n        window.innerHeight : this._scrollElement.getBoundingClientRect().height\n  }\n\n  _process() {\n    const scrollTop    = this._getScrollTop() + this._config.offset\n    const scrollHeight = this._getScrollHeight()\n    const maxScroll    = this._config.offset\n      + scrollHeight\n      - this._getOffsetHeight()\n\n    if (this._scrollHeight !== scrollHeight) {\n      this.refresh()\n    }\n\n    if (scrollTop >= maxScroll) {\n      const target = this._targets[this._targets.length - 1]\n\n      if (this._activeTarget !== target) {\n        this._activate(target)\n      }\n      return\n    }\n\n    if (this._activeTarget && scrollTop < this._offsets[0] && this._offsets[0] > 0) {\n      this._activeTarget = null\n      this._clear()\n      return\n    }\n\n    for (let i = this._offsets.length; i--;) {\n      const isActiveTarget = this._activeTarget !== this._targets[i]\n          && scrollTop >= this._offsets[i]\n          && (this._offsets[i + 1] === undefined ||\n              scrollTop < this._offsets[i + 1])\n\n      if (isActiveTarget) {\n        this._activate(this._targets[i])\n      }\n    }\n  }\n\n  _activate(target) {\n    this._activeTarget = target\n\n    this._clear()\n\n    let queries = this._selector.split(',')\n    queries     = queries.map((selector) => {\n      return `${selector}[data-target=\"${target}\"],` +\n              `${selector}[href=\"${target}\"]`\n    })\n\n    const $link = $(queries.join(','))\n\n    if ($link.hasClass(ClassName.DROPDOWN_ITEM)) {\n      $link.closest(Selector.DROPDOWN).find(Selector.DROPDOWN_TOGGLE).addClass(ClassName.ACTIVE)\n      $link.addClass(ClassName.ACTIVE)\n    } else {\n      // Set triggered link as active\n      $link.addClass(ClassName.ACTIVE)\n      // Set triggered links parents as active\n      // With both <ul> and <nav> markup a parent is the previous sibling of any nav ancestor\n      $link.parents(Selector.NAV_LIST_GROUP).prev(`${Selector.NAV_LINKS}, ${Selector.LIST_ITEMS}`).addClass(ClassName.ACTIVE)\n    }\n\n    $(this._scrollElement).trigger(Event.ACTIVATE, {\n      relatedTarget: target\n    })\n  }\n\n  _clear() {\n    $(this._selector).filter(Selector.ACTIVE).removeClass(ClassName.ACTIVE)\n  }\n\n  // static\n\n  static _jQueryInterface(config) {\n    return this.each(function () {\n      let data      = $(this).data(DATA_KEY)\n      const _config = typeof config === 'object' && config\n\n      if (!data) {\n        data = new ScrollSpy(this, _config)\n        $(this).data(DATA_KEY, data)\n      }\n\n      if (typeof config === 'string') {\n        if (data[config] === undefined) {\n          throw new Error(`No method named \"${config}\"`)\n        }\n        data[config]()\n      }\n    })\n  }\n}\n\n/**\n * ------------------------------------------------------------------------\n * Data Api implementation\n * ------------------------------------------------------------------------\n */\n\n$(window).on(Event.LOAD_DATA_API, () => {\n  const scrollSpys = $.makeArray($(Selector.DATA_SPY))\n\n  for (let i = scrollSpys.length; i--;) {\n    const $spy = $(scrollSpys[i])\n    ScrollSpy._jQueryInterface.call($spy, $spy.data())\n  }\n})\n\n/**\n * ------------------------------------------------------------------------\n * jQuery\n * ------------------------------------------------------------------------\n */\n\n$.fn[NAME]             = ScrollSpy._jQueryInterface\n$.fn[NAME].Constructor = ScrollSpy\n$.fn[NAME].noConflict  = function () {\n  $.fn[NAME] = JQUERY_NO_CONFLICT\n  return ScrollSpy._jQueryInterface\n}\n"],"names":["NAME","VERSION","DATA_KEY","EVENT_KEY","DATA_API_KEY","JQUERY_NO_CONFLICT","$","fn","Default","DefaultType","Event","ClassName","Selector","OffsetMethod","ScrollSpy","element","config","_element","_scrollElement","tagName","window","_config","_getConfig","_selector","target","NAV_LINKS","LIST_ITEMS","DROPDOWN_ITEMS","_offsets","_targets","_activeTarget","_scrollHeight","on","SCROLL","event","_process","refresh","autoMethod","POSITION","OFFSET","offsetMethod","method","offsetBase","_getScrollTop","_getScrollHeight","targets","makeArray","map","targetSelector","Util","getSelectorFromElement","targetBCR","getBoundingClientRect","width","height","top","filter","item","sort","a","b","forEach","push","removeData","off","extend","id","attr","getUID","typeCheckConfig","pageYOffset","scrollTop","scrollHeight","Math","max","document","body","documentElement","innerHeight","offset","maxScroll","_getOffsetHeight","length","_activate","_clear","i","isActiveTarget","undefined","queries","split","selector","$link","join","hasClass","DROPDOWN_ITEM","closest","DROPDOWN","find","DROPDOWN_TOGGLE","addClass","ACTIVE","parents","NAV_LIST_GROUP","prev","trigger","ACTIVATE","removeClass","each","data","Error","LOAD_DATA_API","scrollSpys","DATA_SPY","$spy","_jQueryInterface","call","Constructor","noConflict"],"mappings":"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"}