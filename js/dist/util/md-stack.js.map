{"version":3,"file":"md-stack.js","sources":["../../src/util/md-stack.js"],"sourcesContent":["import MdSelectorEngine from '../dom/selector-engine';\nimport { isVisible, typeCheckConfig } from './index';\n\nconst NAME = 'Stack';\n\nconst DEFAULT_OPTIONS = {\n  position: 'top',\n  container: null,\n  refresh: 1000,\n  filter: (el) => {\n    return el;\n  },\n};\n\nconst TYPE_OPTIONS = {\n  position: 'string',\n  container: '(undefined|null|string)',\n  refresh: 'number',\n  filter: 'function',\n};\n\nclass Stack {\n  constructor(element, selector, options) {\n    this._element = element;\n    this._selector = selector;\n    this._options = this._getConfig(options);\n\n    this._offset = null;\n\n    if (this._options.container) {\n      this._parent = MdSelectorEngine.findOne(this._options.container);\n    }\n  }\n\n  get stackableElements() {\n    return MdSelectorEngine.find(this._selector)\n      .filter((el, i) => this._options.filter(el, i))\n      .map((el) => ({ el, rect: el.getBoundingClientRect() }))\n      .filter(({ el, rect }) => {\n        const basicCondition = el !== this._element && isVisible(el);\n        if (this._offset === null) {\n          return basicCondition;\n        }\n\n        return basicCondition && this._getBoundryOffset(rect) < this._offset;\n      })\n      .sort((a, b) => {\n        return this._getBoundryOffset(b.rect) - this._getBoundryOffset(a.rect);\n      });\n  }\n\n  get nextElements() {\n    return MdSelectorEngine.find(this._selector)\n      .filter((el) => el !== this._element)\n      .filter((el, i) => this._options.filter(el, i))\n      .filter((el) => {\n        this._offset = null;\n        return this._getBoundryOffset(el.getBoundingClientRect()) > this._offset;\n      });\n  }\n\n  _getConfig(options) {\n    const config = {\n      ...DEFAULT_OPTIONS,\n      ...options,\n    };\n\n    typeCheckConfig(NAME, config, TYPE_OPTIONS);\n\n    return config;\n  }\n\n  _getBoundryOffset(rect) {\n    const { position } = this._options;\n\n    let parentTopOffset = 0;\n    let parentBottomBoundry = window.innerHeight;\n\n    if (this._parent) {\n      const parentRect = this._parent.getBoundingClientRect();\n\n      parentTopOffset = parentRect.top;\n      parentBottomBoundry = parentRect.bottom;\n    }\n\n    if (position === 'top') {\n      return rect.top - parentTopOffset;\n    }\n    return parentBottomBoundry - rect.bottom;\n  }\n\n  calculateOffset() {\n    const [previousElement] = this.stackableElements;\n\n    if (!previousElement) {\n      this._offset = 0;\n    } else {\n      this._offset = this._getBoundryOffset(previousElement.rect) + previousElement.rect.height;\n    }\n\n    return this._offset;\n  }\n}\n\nexport default Stack;\n"],"names":["NAME","DEFAULT_OPTIONS","position","container","refresh","filter","el","TYPE_OPTIONS","Stack","constructor","element","selector","options","_element","_selector","_options","_getConfig","_offset","_parent","MdSelectorEngine","findOne","stackableElements","find","i","map","rect","getBoundingClientRect","basicCondition","isVisible","_getBoundryOffset","sort","a","b","nextElements","config","typeCheckConfig","parentTopOffset","parentBottomBoundry","window","innerHeight","parentRect","top","bottom","calculateOffset","previousElement","height"],"mappings":"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"}