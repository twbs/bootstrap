{"version":3,"file":"datepicker.js","sources":["../src/datepicker.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Bootstrap datepicker.js\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport { Calendar } from 'vanilla-calendar-pro'\nimport BaseComponent from './base-component.js'\nimport EventHandler from './dom/event-handler.js'\nimport { isDisabled } from './util/index.js'\n\n/**\n * Constants\n */\n\nconst NAME = 'datepicker'\nconst DATA_KEY = 'bs.datepicker'\nconst EVENT_KEY = `.${DATA_KEY}`\nconst DATA_API_KEY = '.data-api'\n\nconst EVENT_CHANGE = `change${EVENT_KEY}`\nconst EVENT_SHOW = `show${EVENT_KEY}`\nconst EVENT_SHOWN = `shown${EVENT_KEY}`\nconst EVENT_HIDE = `hide${EVENT_KEY}`\nconst EVENT_HIDDEN = `hidden${EVENT_KEY}`\nconst EVENT_CLICK_DATA_API = `click${EVENT_KEY}${DATA_API_KEY}`\nconst EVENT_FOCUSIN_DATA_API = `focusin${EVENT_KEY}${DATA_API_KEY}`\n\nconst SELECTOR_DATA_TOGGLE = '[data-bs-toggle=\"datepicker\"]'\n\nconst HIDE_DELAY = 100 // ms delay before hiding after selection\n\nconst Default = {\n  datepickerTheme: null, // 'light', 'dark', 'auto' - explicit theme for datepicker popover only\n  dateMin: null,\n  dateMax: null,\n  dateFormat: null, // Intl.DateTimeFormat options, or function(date, locale) => string\n  displayElement: null, // Element to show formatted date (defaults to element for buttons)\n  displayMonthsCount: 1, // Number of months to display side-by-side\n  firstWeekday: 1, // Monday\n  inline: false, // Render calendar inline (no popup)\n  locale: 'default',\n  positionElement: null, // Element to position calendar relative to (defaults to input)\n  selectedDates: [],\n  selectionMode: 'single', // 'single', 'multiple', 'multiple-ranged'\n  placement: 'left', // 'left', 'center', 'right', 'auto'\n  vcpOptions: {} // Pass-through for any VCP option\n}\n\nconst DefaultType = {\n  datepickerTheme: '(null|string)',\n  dateMin: '(null|string|number|object)',\n  dateMax: '(null|string|number|object)',\n  dateFormat: '(null|object|function)',\n  displayElement: '(null|string|element|boolean)',\n  displayMonthsCount: 'number',\n  firstWeekday: 'number',\n  inline: 'boolean',\n  locale: 'string',\n  positionElement: '(null|string|element)',\n  selectedDates: 'array',\n  selectionMode: 'string',\n  placement: 'string',\n  vcpOptions: 'object'\n}\n\n/**\n * Class definition\n */\n\nclass Datepicker extends BaseComponent {\n  constructor(element, config) {\n    super(element, config)\n\n    this._calendar = null\n    this._isShown = false\n\n    this._initCalendar()\n  }\n\n  // Getters\n  static get Default() {\n    return Default\n  }\n\n  static get DefaultType() {\n    return DefaultType\n  }\n\n  static get NAME() {\n    return NAME\n  }\n\n  // Public\n  toggle() {\n    if (this._config.inline) {\n      return // Inline calendars are always visible\n    }\n\n    return this._isShown ? this.hide() : this.show()\n  }\n\n  show() {\n    if (this._config.inline) {\n      return // Inline calendars are always visible\n    }\n\n    if (!this._calendar || isDisabled(this._element) || this._isShown) {\n      return\n    }\n\n    const showEvent = EventHandler.trigger(this._element, EVENT_SHOW)\n    if (showEvent.defaultPrevented) {\n      return\n    }\n\n    this._calendar.show()\n    this._isShown = true\n\n    EventHandler.trigger(this._element, EVENT_SHOWN)\n  }\n\n  hide() {\n    if (this._config.inline) {\n      return // Inline calendars are always visible\n    }\n\n    if (!this._calendar || !this._isShown) {\n      return\n    }\n\n    const hideEvent = EventHandler.trigger(this._element, EVENT_HIDE)\n    if (hideEvent.defaultPrevented) {\n      return\n    }\n\n    this._calendar.hide()\n    this._isShown = false\n\n    EventHandler.trigger(this._element, EVENT_HIDDEN)\n  }\n\n  dispose() {\n    if (this._themeObserver) {\n      this._themeObserver.disconnect()\n      this._themeObserver = null\n    }\n\n    if (this._calendar) {\n      this._calendar.destroy()\n    }\n\n    this._calendar = null\n    super.dispose()\n  }\n\n  getSelectedDates() {\n    const dates = this._calendar?.context?.selectedDates\n    return dates ? [...dates] : []\n  }\n\n  setSelectedDates(dates) {\n    if (this._calendar) {\n      this._calendar.set({ selectedDates: dates })\n    }\n  }\n\n  // Private\n  _initCalendar() {\n    this._isInput = this._element.tagName === 'INPUT'\n    this._isInline = this._config.inline\n\n    // For inline mode, look for a hidden input child to bind to\n    if (this._isInline && !this._isInput) {\n      this._boundInput = this._element.querySelector('input[type=\"hidden\"], input[name]')\n    }\n\n    this._positionElement = this._resolvePositionElement()\n    this._displayElement = this._resolveDisplayElement()\n\n    const calendarOptions = this._buildCalendarOptions()\n\n    // Create calendar on the position element (for correct popup positioning)\n    // but value updates still go to this._element (the input)\n    this._calendar = new Calendar(this._positionElement, calendarOptions)\n    this._calendar.init()\n\n    // Watch for theme changes on ancestor elements (for live theme switching)\n    this._setupThemeObserver()\n\n    // Set initial value if input has a value\n    if (this._isInput && this._element.value) {\n      this._parseInputValue()\n    }\n\n    // Populate input/display with preselected dates\n    this._updateDisplayWithSelectedDates()\n  }\n\n  _updateDisplayWithSelectedDates() {\n    const { selectedDates } = this._config\n    if (!selectedDates || selectedDates.length === 0) {\n      return\n    }\n\n    const formattedDate = this._formatDateForInput(selectedDates)\n\n    if (this._isInput) {\n      this._element.value = formattedDate\n    }\n\n    if (this._boundInput) {\n      this._boundInput.value = selectedDates.join(',')\n    }\n\n    if (this._displayElement) {\n      this._displayElement.textContent = formattedDate\n    }\n  }\n\n  _resolvePositionElement() {\n    let { positionElement } = this._config\n\n    if (typeof positionElement === 'string') {\n      positionElement = document.querySelector(positionElement)\n    }\n\n    // Use input's parent if in form-adorn\n    if (!positionElement && this._isInput && !this._isInline) {\n      const parent = this._element.closest('.form-adorn')\n      if (parent) {\n        positionElement = parent\n      }\n    }\n\n    return positionElement || this._element\n  }\n\n  _resolveDisplayElement() {\n    const { displayElement } = this._config\n\n    if (typeof displayElement === 'string') {\n      return document.querySelector(displayElement)\n    }\n\n    // For buttons/non-inputs (not inline), look for a [data-bs-datepicker-display] child\n    if (displayElement === true || (displayElement === null && !this._isInput && !this._isInline)) {\n      const displayChild = this._element.querySelector('[data-bs-datepicker-display]')\n      return displayChild || this._element\n    }\n\n    return displayElement\n  }\n\n  _getThemeAncestor() {\n    return this._element.closest('[data-bs-theme]')\n  }\n\n  _getEffectiveTheme() {\n    // Priority: explicit datepickerTheme config > inherited from ancestor > none\n    const { datepickerTheme } = this._config\n    if (datepickerTheme) {\n      return datepickerTheme\n    }\n\n    const ancestor = this._getThemeAncestor()\n    return ancestor?.getAttribute('data-bs-theme') || null\n  }\n\n  _syncThemeAttribute(element) {\n    if (!element) {\n      return\n    }\n\n    const theme = this._getEffectiveTheme()\n\n    if (theme) {\n      // Copy theme to popover (needed because VCP appends to body, breaking CSS inheritance)\n      element.setAttribute('data-bs-theme', theme)\n    } else {\n      // No theme - remove attribute to allow natural inheritance\n      element.removeAttribute('data-bs-theme')\n    }\n  }\n\n  _setupThemeObserver() {\n    // Watch for theme changes on ancestor elements\n    const ancestor = this._getThemeAncestor()\n    if (!ancestor || this._config.datepickerTheme) {\n      // No ancestor to watch, or explicit datepickerTheme overrides\n      return\n    }\n\n    this._themeObserver = new MutationObserver(() => {\n      this._syncThemeAttribute(this._calendar?.context?.mainElement)\n    })\n\n    this._themeObserver.observe(ancestor, {\n      attributes: true,\n      attributeFilter: ['data-bs-theme']\n    })\n  }\n\n  _buildCalendarOptions() {\n    // Get theme for VCP - use 'system' for auto-detection if no explicit theme\n    const theme = this._getEffectiveTheme()\n    // VCP uses 'system' for auto, Bootstrap uses 'auto'\n    const vcpTheme = !theme || theme === 'auto' ? 'system' : theme\n\n    const calendarOptions = {\n      ...this._config.vcpOptions,\n      inputMode: !this._isInline,\n      positionToInput: this._config.placement,\n      firstWeekday: this._config.firstWeekday,\n      locale: this._config.locale,\n      selectionDatesMode: this._config.selectionMode,\n      selectedDates: this._config.selectedDates,\n      displayMonthsCount: this._config.displayMonthsCount,\n      type: this._config.displayMonthsCount > 1 ? 'multiple' : 'default',\n      selectedTheme: vcpTheme,\n      themeAttrDetect: '[data-bs-theme]',\n      onClickDate: (self, event) => this._handleDateClick(self, event),\n      onInit: self => {\n        this._syncThemeAttribute(self.context.mainElement)\n      },\n      onShow: () => {\n        this._isShown = true\n        this._syncThemeAttribute(this._calendar.context.mainElement)\n      },\n      onHide: () => {\n        this._isShown = false\n      }\n    }\n\n    // Navigate to the month of the first selected date\n    if (this._config.selectedDates.length > 0) {\n      const firstDate = this._parseDate(this._config.selectedDates[0])\n      calendarOptions.selectedMonth = firstDate.getMonth()\n      calendarOptions.selectedYear = firstDate.getFullYear()\n    }\n\n    if (this._config.dateMin) {\n      calendarOptions.dateMin = this._config.dateMin\n    }\n\n    if (this._config.dateMax) {\n      calendarOptions.dateMax = this._config.dateMax\n    }\n\n    return calendarOptions\n  }\n\n  _handleDateClick(self, event) {\n    const selectedDates = [...self.context.selectedDates]\n\n    if (selectedDates.length > 0) {\n      const formattedDate = this._formatDateForInput(selectedDates)\n\n      if (this._isInput) {\n        this._element.value = formattedDate\n      }\n\n      if (this._boundInput) {\n        this._boundInput.value = selectedDates.join(',')\n      }\n\n      if (this._displayElement) {\n        this._displayElement.textContent = formattedDate\n      }\n    }\n\n    EventHandler.trigger(this._element, EVENT_CHANGE, {\n      dates: selectedDates,\n      event\n    })\n\n    this._maybeHideAfterSelection(selectedDates)\n  }\n\n  _maybeHideAfterSelection(selectedDates) {\n    if (this._isInline) {\n      return\n    }\n\n    const shouldHide =\n      (this._config.selectionMode === 'single' && selectedDates.length > 0) ||\n      (this._config.selectionMode === 'multiple-ranged' && selectedDates.length >= 2)\n\n    if (shouldHide) {\n      setTimeout(() => this.hide(), HIDE_DELAY)\n    }\n  }\n\n  _parseDate(dateStr) {\n    const [year, month, day] = dateStr.split('-')\n    return new Date(year, month - 1, day)\n  }\n\n  _formatDate(dateStr) {\n    const date = this._parseDate(dateStr)\n    const locale = this._config.locale === 'default' ? undefined : this._config.locale\n    const { dateFormat } = this._config\n\n    // Custom function formatter\n    if (typeof dateFormat === 'function') {\n      return dateFormat(date, locale)\n    }\n\n    // Intl.DateTimeFormat options object\n    if (dateFormat && typeof dateFormat === 'object') {\n      return new Intl.DateTimeFormat(locale, dateFormat).format(date)\n    }\n\n    // Default: locale-aware formatting\n    return date.toLocaleDateString(locale)\n  }\n\n  _formatDateForInput(dates) {\n    if (dates.length === 0) {\n      return ''\n    }\n\n    if (dates.length === 1) {\n      return this._formatDate(dates[0])\n    }\n\n    // For date ranges, use en-dash; for multiple dates, use comma\n    const separator = this._config.selectionMode === 'multiple-ranged' ? ' â€“ ' : ', '\n    return dates.map(d => this._formatDate(d)).join(separator)\n  }\n\n  _parseInputValue() {\n    // Try to parse the input value as a date\n    const value = this._element.value.trim()\n    if (!value) {\n      return\n    }\n\n    const date = new Date(value)\n    if (!Number.isNaN(date.getTime())) {\n      const year = date.getFullYear()\n      const month = String(date.getMonth() + 1).padStart(2, '0')\n      const day = String(date.getDate()).padStart(2, '0')\n      const formatted = `${year}-${month}-${day}`\n      this._calendar.set({ selectedDates: [formatted] })\n    }\n  }\n}\n\n/**\n * Data API implementation\n */\n\nEventHandler.on(document, EVENT_CLICK_DATA_API, SELECTOR_DATA_TOGGLE, function (event) {\n  // Only handle if not an input (inputs use focus)\n  // Skip inline datepickers (they're always visible)\n  if (this.tagName === 'INPUT' || this.dataset.bsInline === 'true') {\n    return\n  }\n\n  event.preventDefault()\n  Datepicker.getOrCreateInstance(this).toggle()\n})\n\nEventHandler.on(document, EVENT_FOCUSIN_DATA_API, SELECTOR_DATA_TOGGLE, function () {\n  // Handle focus for input elements\n  if (this.tagName !== 'INPUT') {\n    return\n  }\n\n  Datepicker.getOrCreateInstance(this).show()\n})\n\n// Auto-initialize inline datepickers on DOMContentLoaded\nEventHandler.on(document, `DOMContentLoaded${EVENT_KEY}${DATA_API_KEY}`, () => {\n  for (const element of document.querySelectorAll(`${SELECTOR_DATA_TOGGLE}[data-bs-inline=\"true\"]`)) {\n    Datepicker.getOrCreateInstance(element)\n  }\n})\n\nexport default Datepicker\n"],"names":["NAME","DATA_KEY","EVENT_KEY","DATA_API_KEY","EVENT_CHANGE","EVENT_SHOW","EVENT_SHOWN","EVENT_HIDE","EVENT_HIDDEN","EVENT_CLICK_DATA_API","EVENT_FOCUSIN_DATA_API","SELECTOR_DATA_TOGGLE","HIDE_DELAY","Default","datepickerTheme","dateMin","dateMax","dateFormat","displayElement","displayMonthsCount","firstWeekday","inline","locale","positionElement","selectedDates","selectionMode","placement","vcpOptions","DefaultType","Datepicker","BaseComponent","constructor","element","config","_calendar","_isShown","_initCalendar","toggle","_config","hide","show","isDisabled","_element","showEvent","EventHandler","trigger","defaultPrevented","hideEvent","dispose","_themeObserver","disconnect","destroy","getSelectedDates","dates","context","setSelectedDates","set","_isInput","tagName","_isInline","_boundInput","querySelector","_positionElement","_resolvePositionElement","_displayElement","_resolveDisplayElement","calendarOptions","_buildCalendarOptions","Calendar","init","_setupThemeObserver","value","_parseInputValue","_updateDisplayWithSelectedDates","length","formattedDate","_formatDateForInput","join","textContent","document","parent","closest","displayChild","_getThemeAncestor","_getEffectiveTheme","ancestor","getAttribute","_syncThemeAttribute","theme","setAttribute","removeAttribute","MutationObserver","mainElement","observe","attributes","attributeFilter","vcpTheme","inputMode","positionToInput","selectionDatesMode","type","selectedTheme","themeAttrDetect","onClickDate","self","event","_handleDateClick","onInit","onShow","onHide","firstDate","_parseDate","selectedMonth","getMonth","selectedYear","getFullYear","_maybeHideAfterSelection","shouldHide","setTimeout","dateStr","year","month","day","split","Date","_formatDate","date","undefined","Intl","DateTimeFormat","format","toLocaleDateString","separator","map","d","trim","Number","isNaN","getTime","String","padStart","getDate","formatted","on","dataset","bsInline","preventDefault","getOrCreateInstance","querySelectorAll"],"mappings":";;;;;;;;;;;EAAA;EACA;EACA;EACA;EACA;EACA;;;EAOA;EACA;EACA;;EAEA,MAAMA,IAAI,GAAG,YAAY;EACzB,MAAMC,QAAQ,GAAG,eAAe;EAChC,MAAMC,SAAS,GAAG,CAAA,CAAA,EAAID,QAAQ,CAAA,CAAE;EAChC,MAAME,YAAY,GAAG,WAAW;EAEhC,MAAMC,YAAY,GAAG,CAAA,MAAA,EAASF,SAAS,CAAA,CAAE;EACzC,MAAMG,UAAU,GAAG,CAAA,IAAA,EAAOH,SAAS,CAAA,CAAE;EACrC,MAAMI,WAAW,GAAG,CAAA,KAAA,EAAQJ,SAAS,CAAA,CAAE;EACvC,MAAMK,UAAU,GAAG,CAAA,IAAA,EAAOL,SAAS,CAAA,CAAE;EACrC,MAAMM,YAAY,GAAG,CAAA,MAAA,EAASN,SAAS,CAAA,CAAE;EACzC,MAAMO,oBAAoB,GAAG,CAAA,KAAA,EAAQP,SAAS,CAAA,EAAGC,YAAY,CAAA,CAAE;EAC/D,MAAMO,sBAAsB,GAAG,CAAA,OAAA,EAAUR,SAAS,CAAA,EAAGC,YAAY,CAAA,CAAE;EAEnE,MAAMQ,oBAAoB,GAAG,+BAA+B;EAE5D,MAAMC,UAAU,GAAG,GAAG,CAAA;;EAEtB,MAAMC,OAAO,GAAG;EACdC,EAAAA,eAAe,EAAE,IAAI;EAAE;EACvBC,EAAAA,OAAO,EAAE,IAAI;EACbC,EAAAA,OAAO,EAAE,IAAI;EACbC,EAAAA,UAAU,EAAE,IAAI;EAAE;EAClBC,EAAAA,cAAc,EAAE,IAAI;EAAE;EACtBC,EAAAA,kBAAkB,EAAE,CAAC;EAAE;EACvBC,EAAAA,YAAY,EAAE,CAAC;EAAE;EACjBC,EAAAA,MAAM,EAAE,KAAK;EAAE;EACfC,EAAAA,MAAM,EAAE,SAAS;EACjBC,EAAAA,eAAe,EAAE,IAAI;EAAE;EACvBC,EAAAA,aAAa,EAAE,EAAE;EACjBC,EAAAA,aAAa,EAAE,QAAQ;EAAE;EACzBC,EAAAA,SAAS,EAAE,MAAM;EAAE;IACnBC,UAAU,EAAE,EAAE;EAChB,CAAC;EAED,MAAMC,WAAW,GAAG;EAClBd,EAAAA,eAAe,EAAE,eAAe;EAChCC,EAAAA,OAAO,EAAE,6BAA6B;EACtCC,EAAAA,OAAO,EAAE,6BAA6B;EACtCC,EAAAA,UAAU,EAAE,wBAAwB;EACpCC,EAAAA,cAAc,EAAE,+BAA+B;EAC/CC,EAAAA,kBAAkB,EAAE,QAAQ;EAC5BC,EAAAA,YAAY,EAAE,QAAQ;EACtBC,EAAAA,MAAM,EAAE,SAAS;EACjBC,EAAAA,MAAM,EAAE,QAAQ;EAChBC,EAAAA,eAAe,EAAE,uBAAuB;EACxCC,EAAAA,aAAa,EAAE,OAAO;EACtBC,EAAAA,aAAa,EAAE,QAAQ;EACvBC,EAAAA,SAAS,EAAE,QAAQ;EACnBC,EAAAA,UAAU,EAAE;EACd,CAAC;;EAED;EACA;EACA;;EAEA,MAAME,UAAU,SAASC,aAAa,CAAC;EACrCC,EAAAA,WAAWA,CAACC,OAAO,EAAEC,MAAM,EAAE;EAC3B,IAAA,KAAK,CAACD,OAAO,EAAEC,MAAM,CAAC;MAEtB,IAAI,CAACC,SAAS,GAAG,IAAI;MACrB,IAAI,CAACC,QAAQ,GAAG,KAAK;MAErB,IAAI,CAACC,aAAa,EAAE;EACtB,EAAA;;EAEA;IACA,WAAWvB,OAAOA,GAAG;EACnB,IAAA,OAAOA,OAAO;EAChB,EAAA;IAEA,WAAWe,WAAWA,GAAG;EACvB,IAAA,OAAOA,WAAW;EACpB,EAAA;IAEA,WAAW5B,IAAIA,GAAG;EAChB,IAAA,OAAOA,IAAI;EACb,EAAA;;EAEA;EACAqC,EAAAA,MAAMA,GAAG;EACP,IAAA,IAAI,IAAI,CAACC,OAAO,CAACjB,MAAM,EAAE;EACvB,MAAA,OAAM;EACR,IAAA;EAEA,IAAA,OAAO,IAAI,CAACc,QAAQ,GAAG,IAAI,CAACI,IAAI,EAAE,GAAG,IAAI,CAACC,IAAI,EAAE;EAClD,EAAA;EAEAA,EAAAA,IAAIA,GAAG;EACL,IAAA,IAAI,IAAI,CAACF,OAAO,CAACjB,MAAM,EAAE;EACvB,MAAA,OAAM;EACR,IAAA;EAEA,IAAA,IAAI,CAAC,IAAI,CAACa,SAAS,IAAIO,mBAAU,CAAC,IAAI,CAACC,QAAQ,CAAC,IAAI,IAAI,CAACP,QAAQ,EAAE;EACjE,MAAA;EACF,IAAA;MAEA,MAAMQ,SAAS,GAAGC,YAAY,CAACC,OAAO,CAAC,IAAI,CAACH,QAAQ,EAAErC,UAAU,CAAC;MACjE,IAAIsC,SAAS,CAACG,gBAAgB,EAAE;EAC9B,MAAA;EACF,IAAA;EAEA,IAAA,IAAI,CAACZ,SAAS,CAACM,IAAI,EAAE;MACrB,IAAI,CAACL,QAAQ,GAAG,IAAI;MAEpBS,YAAY,CAACC,OAAO,CAAC,IAAI,CAACH,QAAQ,EAAEpC,WAAW,CAAC;EAClD,EAAA;EAEAiC,EAAAA,IAAIA,GAAG;EACL,IAAA,IAAI,IAAI,CAACD,OAAO,CAACjB,MAAM,EAAE;EACvB,MAAA,OAAM;EACR,IAAA;MAEA,IAAI,CAAC,IAAI,CAACa,SAAS,IAAI,CAAC,IAAI,CAACC,QAAQ,EAAE;EACrC,MAAA;EACF,IAAA;MAEA,MAAMY,SAAS,GAAGH,YAAY,CAACC,OAAO,CAAC,IAAI,CAACH,QAAQ,EAAEnC,UAAU,CAAC;MACjE,IAAIwC,SAAS,CAACD,gBAAgB,EAAE;EAC9B,MAAA;EACF,IAAA;EAEA,IAAA,IAAI,CAACZ,SAAS,CAACK,IAAI,EAAE;MACrB,IAAI,CAACJ,QAAQ,GAAG,KAAK;MAErBS,YAAY,CAACC,OAAO,CAAC,IAAI,CAACH,QAAQ,EAAElC,YAAY,CAAC;EACnD,EAAA;EAEAwC,EAAAA,OAAOA,GAAG;MACR,IAAI,IAAI,CAACC,cAAc,EAAE;EACvB,MAAA,IAAI,CAACA,cAAc,CAACC,UAAU,EAAE;QAChC,IAAI,CAACD,cAAc,GAAG,IAAI;EAC5B,IAAA;MAEA,IAAI,IAAI,CAACf,SAAS,EAAE;EAClB,MAAA,IAAI,CAACA,SAAS,CAACiB,OAAO,EAAE;EAC1B,IAAA;MAEA,IAAI,CAACjB,SAAS,GAAG,IAAI;MACrB,KAAK,CAACc,OAAO,EAAE;EACjB,EAAA;EAEAI,EAAAA,gBAAgBA,GAAG;MACjB,MAAMC,KAAK,GAAG,IAAI,CAACnB,SAAS,EAAEoB,OAAO,EAAE9B,aAAa;EACpD,IAAA,OAAO6B,KAAK,GAAG,CAAC,GAAGA,KAAK,CAAC,GAAG,EAAE;EAChC,EAAA;IAEAE,gBAAgBA,CAACF,KAAK,EAAE;MACtB,IAAI,IAAI,CAACnB,SAAS,EAAE;EAClB,MAAA,IAAI,CAACA,SAAS,CAACsB,GAAG,CAAC;EAAEhC,QAAAA,aAAa,EAAE6B;EAAM,OAAC,CAAC;EAC9C,IAAA;EACF,EAAA;;EAEA;EACAjB,EAAAA,aAAaA,GAAG;MACd,IAAI,CAACqB,QAAQ,GAAG,IAAI,CAACf,QAAQ,CAACgB,OAAO,KAAK,OAAO;EACjD,IAAA,IAAI,CAACC,SAAS,GAAG,IAAI,CAACrB,OAAO,CAACjB,MAAM;;EAEpC;MACA,IAAI,IAAI,CAACsC,SAAS,IAAI,CAAC,IAAI,CAACF,QAAQ,EAAE;QACpC,IAAI,CAACG,WAAW,GAAG,IAAI,CAAClB,QAAQ,CAACmB,aAAa,CAAC,mCAAmC,CAAC;EACrF,IAAA;EAEA,IAAA,IAAI,CAACC,gBAAgB,GAAG,IAAI,CAACC,uBAAuB,EAAE;EACtD,IAAA,IAAI,CAACC,eAAe,GAAG,IAAI,CAACC,sBAAsB,EAAE;EAEpD,IAAA,MAAMC,eAAe,GAAG,IAAI,CAACC,qBAAqB,EAAE;;EAEpD;EACA;MACA,IAAI,CAACjC,SAAS,GAAG,IAAIkC,2BAAQ,CAAC,IAAI,CAACN,gBAAgB,EAAEI,eAAe,CAAC;EACrE,IAAA,IAAI,CAAChC,SAAS,CAACmC,IAAI,EAAE;;EAErB;MACA,IAAI,CAACC,mBAAmB,EAAE;;EAE1B;MACA,IAAI,IAAI,CAACb,QAAQ,IAAI,IAAI,CAACf,QAAQ,CAAC6B,KAAK,EAAE;QACxC,IAAI,CAACC,gBAAgB,EAAE;EACzB,IAAA;;EAEA;MACA,IAAI,CAACC,+BAA+B,EAAE;EACxC,EAAA;EAEAA,EAAAA,+BAA+BA,GAAG;MAChC,MAAM;EAAEjD,MAAAA;OAAe,GAAG,IAAI,CAACc,OAAO;MACtC,IAAI,CAACd,aAAa,IAAIA,aAAa,CAACkD,MAAM,KAAK,CAAC,EAAE;EAChD,MAAA;EACF,IAAA;EAEA,IAAA,MAAMC,aAAa,GAAG,IAAI,CAACC,mBAAmB,CAACpD,aAAa,CAAC;MAE7D,IAAI,IAAI,CAACiC,QAAQ,EAAE;EACjB,MAAA,IAAI,CAACf,QAAQ,CAAC6B,KAAK,GAAGI,aAAa;EACrC,IAAA;MAEA,IAAI,IAAI,CAACf,WAAW,EAAE;QACpB,IAAI,CAACA,WAAW,CAACW,KAAK,GAAG/C,aAAa,CAACqD,IAAI,CAAC,GAAG,CAAC;EAClD,IAAA;MAEA,IAAI,IAAI,CAACb,eAAe,EAAE;EACxB,MAAA,IAAI,CAACA,eAAe,CAACc,WAAW,GAAGH,aAAa;EAClD,IAAA;EACF,EAAA;EAEAZ,EAAAA,uBAAuBA,GAAG;MACxB,IAAI;EAAExC,MAAAA;OAAiB,GAAG,IAAI,CAACe,OAAO;EAEtC,IAAA,IAAI,OAAOf,eAAe,KAAK,QAAQ,EAAE;EACvCA,MAAAA,eAAe,GAAGwD,QAAQ,CAAClB,aAAa,CAACtC,eAAe,CAAC;EAC3D,IAAA;;EAEA;MACA,IAAI,CAACA,eAAe,IAAI,IAAI,CAACkC,QAAQ,IAAI,CAAC,IAAI,CAACE,SAAS,EAAE;QACxD,MAAMqB,MAAM,GAAG,IAAI,CAACtC,QAAQ,CAACuC,OAAO,CAAC,aAAa,CAAC;EACnD,MAAA,IAAID,MAAM,EAAE;EACVzD,QAAAA,eAAe,GAAGyD,MAAM;EAC1B,MAAA;EACF,IAAA;EAEA,IAAA,OAAOzD,eAAe,IAAI,IAAI,CAACmB,QAAQ;EACzC,EAAA;EAEAuB,EAAAA,sBAAsBA,GAAG;MACvB,MAAM;EAAE/C,MAAAA;OAAgB,GAAG,IAAI,CAACoB,OAAO;EAEvC,IAAA,IAAI,OAAOpB,cAAc,KAAK,QAAQ,EAAE;EACtC,MAAA,OAAO6D,QAAQ,CAAClB,aAAa,CAAC3C,cAAc,CAAC;EAC/C,IAAA;;EAEA;EACA,IAAA,IAAIA,cAAc,KAAK,IAAI,IAAKA,cAAc,KAAK,IAAI,IAAI,CAAC,IAAI,CAACuC,QAAQ,IAAI,CAAC,IAAI,CAACE,SAAU,EAAE;QAC7F,MAAMuB,YAAY,GAAG,IAAI,CAACxC,QAAQ,CAACmB,aAAa,CAAC,8BAA8B,CAAC;EAChF,MAAA,OAAOqB,YAAY,IAAI,IAAI,CAACxC,QAAQ;EACtC,IAAA;EAEA,IAAA,OAAOxB,cAAc;EACvB,EAAA;EAEAiE,EAAAA,iBAAiBA,GAAG;EAClB,IAAA,OAAO,IAAI,CAACzC,QAAQ,CAACuC,OAAO,CAAC,iBAAiB,CAAC;EACjD,EAAA;EAEAG,EAAAA,kBAAkBA,GAAG;EACnB;MACA,MAAM;EAAEtE,MAAAA;OAAiB,GAAG,IAAI,CAACwB,OAAO;EACxC,IAAA,IAAIxB,eAAe,EAAE;EACnB,MAAA,OAAOA,eAAe;EACxB,IAAA;EAEA,IAAA,MAAMuE,QAAQ,GAAG,IAAI,CAACF,iBAAiB,EAAE;EACzC,IAAA,OAAOE,QAAQ,EAAEC,YAAY,CAAC,eAAe,CAAC,IAAI,IAAI;EACxD,EAAA;IAEAC,mBAAmBA,CAACvD,OAAO,EAAE;MAC3B,IAAI,CAACA,OAAO,EAAE;EACZ,MAAA;EACF,IAAA;EAEA,IAAA,MAAMwD,KAAK,GAAG,IAAI,CAACJ,kBAAkB,EAAE;EAEvC,IAAA,IAAII,KAAK,EAAE;EACT;EACAxD,MAAAA,OAAO,CAACyD,YAAY,CAAC,eAAe,EAAED,KAAK,CAAC;EAC9C,IAAA,CAAC,MAAM;EACL;EACAxD,MAAAA,OAAO,CAAC0D,eAAe,CAAC,eAAe,CAAC;EAC1C,IAAA;EACF,EAAA;EAEApB,EAAAA,mBAAmBA,GAAG;EACpB;EACA,IAAA,MAAMe,QAAQ,GAAG,IAAI,CAACF,iBAAiB,EAAE;MACzC,IAAI,CAACE,QAAQ,IAAI,IAAI,CAAC/C,OAAO,CAACxB,eAAe,EAAE;EAC7C;EACA,MAAA;EACF,IAAA;EAEA,IAAA,IAAI,CAACmC,cAAc,GAAG,IAAI0C,gBAAgB,CAAC,MAAM;QAC/C,IAAI,CAACJ,mBAAmB,CAAC,IAAI,CAACrD,SAAS,EAAEoB,OAAO,EAAEsC,WAAW,CAAC;EAChE,IAAA,CAAC,CAAC;EAEF,IAAA,IAAI,CAAC3C,cAAc,CAAC4C,OAAO,CAACR,QAAQ,EAAE;EACpCS,MAAAA,UAAU,EAAE,IAAI;QAChBC,eAAe,EAAE,CAAC,eAAe;EACnC,KAAC,CAAC;EACJ,EAAA;EAEA5B,EAAAA,qBAAqBA,GAAG;EACtB;EACA,IAAA,MAAMqB,KAAK,GAAG,IAAI,CAACJ,kBAAkB,EAAE;EACvC;MACA,MAAMY,QAAQ,GAAG,CAACR,KAAK,IAAIA,KAAK,KAAK,MAAM,GAAG,QAAQ,GAAGA,KAAK;EAE9D,IAAA,MAAMtB,eAAe,GAAG;EACtB,MAAA,GAAG,IAAI,CAAC5B,OAAO,CAACX,UAAU;EAC1BsE,MAAAA,SAAS,EAAE,CAAC,IAAI,CAACtC,SAAS;EAC1BuC,MAAAA,eAAe,EAAE,IAAI,CAAC5D,OAAO,CAACZ,SAAS;EACvCN,MAAAA,YAAY,EAAE,IAAI,CAACkB,OAAO,CAAClB,YAAY;EACvCE,MAAAA,MAAM,EAAE,IAAI,CAACgB,OAAO,CAAChB,MAAM;EAC3B6E,MAAAA,kBAAkB,EAAE,IAAI,CAAC7D,OAAO,CAACb,aAAa;EAC9CD,MAAAA,aAAa,EAAE,IAAI,CAACc,OAAO,CAACd,aAAa;EACzCL,MAAAA,kBAAkB,EAAE,IAAI,CAACmB,OAAO,CAACnB,kBAAkB;QACnDiF,IAAI,EAAE,IAAI,CAAC9D,OAAO,CAACnB,kBAAkB,GAAG,CAAC,GAAG,UAAU,GAAG,SAAS;EAClEkF,MAAAA,aAAa,EAAEL,QAAQ;EACvBM,MAAAA,eAAe,EAAE,iBAAiB;EAClCC,MAAAA,WAAW,EAAEA,CAACC,IAAI,EAAEC,KAAK,KAAK,IAAI,CAACC,gBAAgB,CAACF,IAAI,EAAEC,KAAK,CAAC;QAChEE,MAAM,EAAEH,IAAI,IAAI;UACd,IAAI,CAACjB,mBAAmB,CAACiB,IAAI,CAAClD,OAAO,CAACsC,WAAW,CAAC;QACpD,CAAC;QACDgB,MAAM,EAAEA,MAAM;UACZ,IAAI,CAACzE,QAAQ,GAAG,IAAI;UACpB,IAAI,CAACoD,mBAAmB,CAAC,IAAI,CAACrD,SAAS,CAACoB,OAAO,CAACsC,WAAW,CAAC;QAC9D,CAAC;QACDiB,MAAM,EAAEA,MAAM;UACZ,IAAI,CAAC1E,QAAQ,GAAG,KAAK;EACvB,MAAA;OACD;;EAED;MACA,IAAI,IAAI,CAACG,OAAO,CAACd,aAAa,CAACkD,MAAM,GAAG,CAAC,EAAE;EACzC,MAAA,MAAMoC,SAAS,GAAG,IAAI,CAACC,UAAU,CAAC,IAAI,CAACzE,OAAO,CAACd,aAAa,CAAC,CAAC,CAAC,CAAC;EAChE0C,MAAAA,eAAe,CAAC8C,aAAa,GAAGF,SAAS,CAACG,QAAQ,EAAE;EACpD/C,MAAAA,eAAe,CAACgD,YAAY,GAAGJ,SAAS,CAACK,WAAW,EAAE;EACxD,IAAA;EAEA,IAAA,IAAI,IAAI,CAAC7E,OAAO,CAACvB,OAAO,EAAE;EACxBmD,MAAAA,eAAe,CAACnD,OAAO,GAAG,IAAI,CAACuB,OAAO,CAACvB,OAAO;EAChD,IAAA;EAEA,IAAA,IAAI,IAAI,CAACuB,OAAO,CAACtB,OAAO,EAAE;EACxBkD,MAAAA,eAAe,CAAClD,OAAO,GAAG,IAAI,CAACsB,OAAO,CAACtB,OAAO;EAChD,IAAA;EAEA,IAAA,OAAOkD,eAAe;EACxB,EAAA;EAEAwC,EAAAA,gBAAgBA,CAACF,IAAI,EAAEC,KAAK,EAAE;MAC5B,MAAMjF,aAAa,GAAG,CAAC,GAAGgF,IAAI,CAAClD,OAAO,CAAC9B,aAAa,CAAC;EAErD,IAAA,IAAIA,aAAa,CAACkD,MAAM,GAAG,CAAC,EAAE;EAC5B,MAAA,MAAMC,aAAa,GAAG,IAAI,CAACC,mBAAmB,CAACpD,aAAa,CAAC;QAE7D,IAAI,IAAI,CAACiC,QAAQ,EAAE;EACjB,QAAA,IAAI,CAACf,QAAQ,CAAC6B,KAAK,GAAGI,aAAa;EACrC,MAAA;QAEA,IAAI,IAAI,CAACf,WAAW,EAAE;UACpB,IAAI,CAACA,WAAW,CAACW,KAAK,GAAG/C,aAAa,CAACqD,IAAI,CAAC,GAAG,CAAC;EAClD,MAAA;QAEA,IAAI,IAAI,CAACb,eAAe,EAAE;EACxB,QAAA,IAAI,CAACA,eAAe,CAACc,WAAW,GAAGH,aAAa;EAClD,MAAA;EACF,IAAA;MAEA/B,YAAY,CAACC,OAAO,CAAC,IAAI,CAACH,QAAQ,EAAEtC,YAAY,EAAE;EAChDiD,MAAAA,KAAK,EAAE7B,aAAa;EACpBiF,MAAAA;EACF,KAAC,CAAC;EAEF,IAAA,IAAI,CAACW,wBAAwB,CAAC5F,aAAa,CAAC;EAC9C,EAAA;IAEA4F,wBAAwBA,CAAC5F,aAAa,EAAE;MACtC,IAAI,IAAI,CAACmC,SAAS,EAAE;EAClB,MAAA;EACF,IAAA;EAEA,IAAA,MAAM0D,UAAU,GACb,IAAI,CAAC/E,OAAO,CAACb,aAAa,KAAK,QAAQ,IAAID,aAAa,CAACkD,MAAM,GAAG,CAAC,IACnE,IAAI,CAACpC,OAAO,CAACb,aAAa,KAAK,iBAAiB,IAAID,aAAa,CAACkD,MAAM,IAAI,CAAE;EAEjF,IAAA,IAAI2C,UAAU,EAAE;QACdC,UAAU,CAAC,MAAM,IAAI,CAAC/E,IAAI,EAAE,EAAE3B,UAAU,CAAC;EAC3C,IAAA;EACF,EAAA;IAEAmG,UAAUA,CAACQ,OAAO,EAAE;EAClB,IAAA,MAAM,CAACC,IAAI,EAAEC,KAAK,EAAEC,GAAG,CAAC,GAAGH,OAAO,CAACI,KAAK,CAAC,GAAG,CAAC;MAC7C,OAAO,IAAIC,IAAI,CAACJ,IAAI,EAAEC,KAAK,GAAG,CAAC,EAAEC,GAAG,CAAC;EACvC,EAAA;IAEAG,WAAWA,CAACN,OAAO,EAAE;EACnB,IAAA,MAAMO,IAAI,GAAG,IAAI,CAACf,UAAU,CAACQ,OAAO,CAAC;EACrC,IAAA,MAAMjG,MAAM,GAAG,IAAI,CAACgB,OAAO,CAAChB,MAAM,KAAK,SAAS,GAAGyG,SAAS,GAAG,IAAI,CAACzF,OAAO,CAAChB,MAAM;MAClF,MAAM;EAAEL,MAAAA;OAAY,GAAG,IAAI,CAACqB,OAAO;;EAEnC;EACA,IAAA,IAAI,OAAOrB,UAAU,KAAK,UAAU,EAAE;EACpC,MAAA,OAAOA,UAAU,CAAC6G,IAAI,EAAExG,MAAM,CAAC;EACjC,IAAA;;EAEA;EACA,IAAA,IAAIL,UAAU,IAAI,OAAOA,UAAU,KAAK,QAAQ,EAAE;EAChD,MAAA,OAAO,IAAI+G,IAAI,CAACC,cAAc,CAAC3G,MAAM,EAAEL,UAAU,CAAC,CAACiH,MAAM,CAACJ,IAAI,CAAC;EACjE,IAAA;;EAEA;EACA,IAAA,OAAOA,IAAI,CAACK,kBAAkB,CAAC7G,MAAM,CAAC;EACxC,EAAA;IAEAsD,mBAAmBA,CAACvB,KAAK,EAAE;EACzB,IAAA,IAAIA,KAAK,CAACqB,MAAM,KAAK,CAAC,EAAE;EACtB,MAAA,OAAO,EAAE;EACX,IAAA;EAEA,IAAA,IAAIrB,KAAK,CAACqB,MAAM,KAAK,CAAC,EAAE;QACtB,OAAO,IAAI,CAACmD,WAAW,CAACxE,KAAK,CAAC,CAAC,CAAC,CAAC;EACnC,IAAA;;EAEA;EACA,IAAA,MAAM+E,SAAS,GAAG,IAAI,CAAC9F,OAAO,CAACb,aAAa,KAAK,iBAAiB,GAAG,KAAK,GAAG,IAAI;EACjF,IAAA,OAAO4B,KAAK,CAACgF,GAAG,CAACC,CAAC,IAAI,IAAI,CAACT,WAAW,CAACS,CAAC,CAAC,CAAC,CAACzD,IAAI,CAACuD,SAAS,CAAC;EAC5D,EAAA;EAEA5D,EAAAA,gBAAgBA,GAAG;EACjB;MACA,MAAMD,KAAK,GAAG,IAAI,CAAC7B,QAAQ,CAAC6B,KAAK,CAACgE,IAAI,EAAE;MACxC,IAAI,CAAChE,KAAK,EAAE;EACV,MAAA;EACF,IAAA;EAEA,IAAA,MAAMuD,IAAI,GAAG,IAAIF,IAAI,CAACrD,KAAK,CAAC;MAC5B,IAAI,CAACiE,MAAM,CAACC,KAAK,CAACX,IAAI,CAACY,OAAO,EAAE,CAAC,EAAE;EACjC,MAAA,MAAMlB,IAAI,GAAGM,IAAI,CAACX,WAAW,EAAE;EAC/B,MAAA,MAAMM,KAAK,GAAGkB,MAAM,CAACb,IAAI,CAACb,QAAQ,EAAE,GAAG,CAAC,CAAC,CAAC2B,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC;EAC1D,MAAA,MAAMlB,GAAG,GAAGiB,MAAM,CAACb,IAAI,CAACe,OAAO,EAAE,CAAC,CAACD,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC;QACnD,MAAME,SAAS,GAAG,CAAA,EAAGtB,IAAI,IAAIC,KAAK,CAAA,CAAA,EAAIC,GAAG,CAAA,CAAE;EAC3C,MAAA,IAAI,CAACxF,SAAS,CAACsB,GAAG,CAAC;UAAEhC,aAAa,EAAE,CAACsH,SAAS;EAAE,OAAC,CAAC;EACpD,IAAA;EACF,EAAA;EACF;;EAEA;EACA;EACA;;EAEAlG,YAAY,CAACmG,EAAE,CAAChE,QAAQ,EAAEtE,oBAAoB,EAAEE,oBAAoB,EAAE,UAAU8F,KAAK,EAAE;EACrF;EACA;EACA,EAAA,IAAI,IAAI,CAAC/C,OAAO,KAAK,OAAO,IAAI,IAAI,CAACsF,OAAO,CAACC,QAAQ,KAAK,MAAM,EAAE;EAChE,IAAA;EACF,EAAA;IAEAxC,KAAK,CAACyC,cAAc,EAAE;IACtBrH,UAAU,CAACsH,mBAAmB,CAAC,IAAI,CAAC,CAAC9G,MAAM,EAAE;EAC/C,CAAC,CAAC;EAEFO,YAAY,CAACmG,EAAE,CAAChE,QAAQ,EAAErE,sBAAsB,EAAEC,oBAAoB,EAAE,YAAY;EAClF;EACA,EAAA,IAAI,IAAI,CAAC+C,OAAO,KAAK,OAAO,EAAE;EAC5B,IAAA;EACF,EAAA;IAEA7B,UAAU,CAACsH,mBAAmB,CAAC,IAAI,CAAC,CAAC3G,IAAI,EAAE;EAC7C,CAAC,CAAC;;EAEF;EACAI,YAAY,CAACmG,EAAE,CAAChE,QAAQ,EAAE,CAAA,gBAAA,EAAmB7E,SAAS,CAAA,EAAGC,YAAY,CAAA,CAAE,EAAE,MAAM;IAC7E,KAAK,MAAM6B,OAAO,IAAI+C,QAAQ,CAACqE,gBAAgB,CAAC,CAAA,EAAGzI,oBAAoB,CAAA,uBAAA,CAAyB,CAAC,EAAE;EACjGkB,IAAAA,UAAU,CAACsH,mBAAmB,CAACnH,OAAO,CAAC;EACzC,EAAA;EACF,CAAC,CAAC;;;;;;;;"}