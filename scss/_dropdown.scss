@use "sass:map";
@use "config" as *;
@use "colors" as *;
@use "variables" as *;
@use "mixins/border-radius" as *;
@use "mixins/box-shadow" as *;
@use "mixins/gradients" as *;
@use "mixins/transition" as *;

// scss-docs-start dropdown-tokens
// Customizable via @use 'bootstrap/dropdown' with ($tokens: (...))
$tokens: () !default;

// stylelint-disable scss/dollar-variable-default
$dropdown-tokens: map.merge(
  (
    // scss-docs-start dropdown-css-vars
    --dropdown-zindex: #{$zindex-dropdown},
    --dropdown-gap: .125rem,
    --dropdown-min-width: 10rem,
    --dropdown-padding-x: .25rem,
    --dropdown-padding-y: .25rem,
    --dropdown-spacer: .125rem,
    --dropdown-font-size: #{$font-size-base},
    --dropdown-color: var(--fg-body),
    --dropdown-bg: var(--bg-body),
    --dropdown-border-color: var(--border-color-translucent),
    --dropdown-border-radius: var(--border-radius-lg),
    --dropdown-border-width: var(--border-width),
    --dropdown-inner-border-radius: calc(var(--dropdown-border-radius) - var(--dropdown-border-width)),
    --dropdown-box-shadow: var(--box-shadow),
    --dropdown-divider-bg: var(--border-color-translucent),
    --dropdown-divider-margin-y: .125rem,
    --dropdown-divider-margin-x: .25rem,
    --dropdown-link-color: var(--fg-body),
    --dropdown-link-hover-color: var(--fg-body),
    --dropdown-link-hover-bg: var(--bg-1),
    --dropdown-link-active-color: var(--primary-contrast),
    --dropdown-link-active-bg: var(--primary-bg),
    --dropdown-link-disabled-color: var(--fg-3),
    --dropdown-item-gap: .5rem,
    --dropdown-item-padding-x: .75rem,
    --dropdown-item-padding-y: .25rem,
    --dropdown-item-border-radius: var(--border-radius),
    --dropdown-header-color: var(--fg-2),
    --dropdown-header-padding-x: .75rem,
    --dropdown-header-padding-y: .25rem,
    // scss-docs-end dropdown-css-vars
  ),
  $tokens
);
// stylelint-enable scss/dollar-variable-default
// scss-docs-end dropdown-tokens


@layer components {
  // The dropdown wrapper (`<div>`)
  .dropdown {
    position: relative;
  }

  // The dropdown menu
  .dropdown-menu {
    // scss-docs-start dropdown-css-vars
    @each $prop, $value in $dropdown-tokens {
      #{$prop}: #{$value};
    }
    // scss-docs-end dropdown-css-vars

    position: absolute;
    z-index: var(--dropdown-zindex);
    display: none; // none by default, but flex on "open" of the menu
    flex-direction: column;
    gap: var(--dropdown-gap);
    min-width: var(--dropdown-min-width);
    padding: var(--dropdown-padding-y) var(--dropdown-padding-x);
    margin: 0; // Override default margin of ul
    font-size: var(--dropdown-font-size);
    color: var(--dropdown-color);
    text-align: start; // Ensures proper alignment if parent has it changed (e.g., modal footer)
    list-style: none;
    background-color: var(--dropdown-bg);
    background-clip: padding-box;
    border: var(--dropdown-border-width) solid var(--dropdown-border-color);
    @include border-radius(var(--dropdown-border-radius));
    @include box-shadow(var(--dropdown-box-shadow));
  }

  .dropdown-menu.show {
    display: flex;
  }

  // Dividers (basically an `<hr>`) within the dropdown
  .dropdown-divider {
    height: 0;
    margin: var(--dropdown-divider-margin-y) var(--dropdown-divider-margin-x);
    overflow: hidden;
    border-block-start: 1px solid var(--dropdown-divider-bg);
    opacity: 1;
  }

  // Links, buttons, and more within the dropdown menu
  //
  // `<button>`-specific styles are denoted with `// For <button>s`
  .dropdown-item {
    display: flex;
    gap: var(--dropdown-item-gap);
    align-items: center;
    width: 100%; // For `<button>`s
    padding: var(--dropdown-item-padding-y) var(--dropdown-item-padding-x);
    font-weight: $font-weight-normal;
    color: var(--dropdown-link-color);
    text-align: inherit; // For `<button>`s
    text-decoration: none;
    white-space: nowrap; // prevent links from randomly breaking onto new lines
    background-color: transparent; // For `<button>`s
    border: 0; // For `<button>`s
    @include border-radius(var(--dropdown-item-border-radius, 0));

    &:hover,
    &:focus {
      color: var(--dropdown-link-hover-color);
      @include gradient-bg(var(--dropdown-link-hover-bg));
    }

    &.active,
    &:active {
      color: var(--dropdown-link-active-color);
      @include gradient-bg(var(--dropdown-link-active-bg));
    }

    &.disabled,
    &:disabled {
      color: var(--dropdown-link-disabled-color);
      pointer-events: none;
      background-color: transparent;
      // Remove CSS gradients if they're enabled
      // stylelint-disable-next-line scss/at-function-named-arguments
      background-image: if(sass($enable-gradients): none; else: null);
    }
  }

  // Dropdown section headers
  .dropdown-header {
    display: block;
    padding: var(--dropdown-header-padding-y) var(--dropdown-header-padding-x);
    margin-bottom: 0; // for use with heading elements
    font-size: $font-size-sm;
    color: var(--dropdown-header-color);
    white-space: nowrap; // as with > li > a
  }

  // Dropdown text
  .dropdown-item-text {
    display: block;
    padding: var(--dropdown-item-padding-y) var(--dropdown-item-padding-x);
    color: var(--fg-2);
  }

  // scss-docs-start dropdown-submenu
  // Submenus
  //
  // Nested dropdown menus with hover/click activation and keyboard support.

  .dropdown-submenu {
    position: relative;

    // Submenu trigger styling
    > .dropdown-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    // Submenu caret indicator
    > .dropdown-item::after {
      display: inline-block;
      flex-shrink: 0;
      width: .375em;
      height: .375em;
      margin-inline-start: auto;
      content: "";
      border-color: currentcolor;
      border-style: solid;
      border-width: 0 .125em .125em 0;
      transform: rotate(-45deg);

      // RTL: flip the chevron direction
      [dir="rtl"] & {
        transform: rotate(135deg);
      }
    }

    // Submenu positioning (set by JS via Floating UI)
    > .dropdown-menu {
      top: 0;
      // Offset to align with parent item
      margin-top: calc(-1 * var(--dropdown-padding-y));
    }

    // Hover state for submenu trigger
    &:hover > .dropdown-item,
    &:focus-within > .dropdown-item {
      color: var(--dropdown-link-hover-color);
      background-color: var(--dropdown-link-hover-bg);
    }

    // Active/open state
    &.show > .dropdown-item {
      color: var(--dropdown-link-hover-color);
      background-color: var(--dropdown-link-hover-bg);
    }
  }
  // scss-docs-end dropdown-submenu
}
