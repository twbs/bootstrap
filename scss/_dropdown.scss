@use "sass:map";
@use "config" as *;
@use "colors" as *;
@use "variables" as *;
@use "mixins/border-radius" as *;
@use "mixins/box-shadow" as *;
@use "mixins/gradients" as *;
@use "mixins/transition" as *;

// scss-docs-start dropdown-variables
$dropdown-gap:                      $spacer * .125 !default;
$dropdown-min-width:                10rem !default;
$dropdown-padding-x:                .25rem !default;
$dropdown-padding-y:                .25rem !default;
$dropdown-spacer:                   .125rem !default;
$dropdown-font-size:                $font-size-base !default;
$dropdown-color:                    var(--fg-body) !default;
$dropdown-bg:                       var(--bg-body) !default;
$dropdown-border-color:             var(--border-color-translucent) !default;
$dropdown-border-radius:            var(--border-radius-lg) !default;
$dropdown-border-width:             var(--border-width) !default;
$dropdown-inner-border-radius:      calc(#{$dropdown-border-radius} - #{$dropdown-border-width}) !default;
$dropdown-box-shadow:               var(--box-shadow) !default;

$dropdown-divider-bg:               $dropdown-border-color !default;
$dropdown-divider-margin-y:         $spacer * .125 !default;
$dropdown-divider-margin-x:         $spacer * .25 !default;

$dropdown-link-color:               var(--fg-body) !default;
$dropdown-link-hover-color:         $dropdown-link-color !default;
$dropdown-link-hover-bg:            var(--bg-1) !default;

$dropdown-link-active-color:        $component-active-color !default;
$dropdown-link-active-bg:           $component-active-bg !default;

$dropdown-link-disabled-color:      var(--fg-3) !default;

$dropdown-item-padding-y:           $spacer * .25 !default;
$dropdown-item-padding-x:           $spacer * .75 !default;
$dropdown-item-border-radius:       var(--border-radius) !default;
$dropdown-item-gap:                 $spacer * .5 !default;

$dropdown-header-color:             var(--gray-600) !default;
$dropdown-header-padding-x:         $dropdown-item-padding-x !default;
$dropdown-header-padding-y:         $dropdown-padding-y !default;
// scss-docs-end dropdown-variables

// scss-docs-start dropdown-dark-variables
$dropdown-dark-color:               var(--gray-300) !default;
$dropdown-dark-bg:                  var(--gray-900) !default;
$dropdown-dark-border-color:        $dropdown-border-color !default;
$dropdown-dark-divider-bg:          $dropdown-divider-bg !default;
$dropdown-dark-box-shadow:          null !default;
$dropdown-dark-link-color:          $dropdown-dark-color !default;
$dropdown-dark-link-hover-color:    $white !default;
$dropdown-dark-link-hover-bg:       rgba($white, .15) !default;
$dropdown-dark-link-active-color:   $dropdown-link-active-color !default;
$dropdown-dark-link-active-bg:      $dropdown-link-active-bg !default;
$dropdown-dark-link-disabled-color: var(--gray-500) !default;
$dropdown-dark-header-color:        var(--gray-500) !default;
// scss-docs-end dropdown-dark-variables

@layer components {
  // The dropdown wrapper (`<div>`)
  .dropdown {
    position: relative;
  }

  // The dropdown menu
  .dropdown-menu {
    // scss-docs-start dropdown-css-vars
    --dropdown-zindex: #{$zindex-dropdown};
    --dropdown-gap: #{$dropdown-gap};
    --dropdown-min-width: #{$dropdown-min-width};
    --dropdown-padding-x: #{$dropdown-padding-x};
    --dropdown-padding-y: #{$dropdown-padding-y};
    --dropdown-spacer: #{$dropdown-spacer};
    --dropdown-font-size: #{$dropdown-font-size};
    --dropdown-color: #{$dropdown-color};
    --dropdown-bg: #{$dropdown-bg};
    --dropdown-border-color: #{$dropdown-border-color};
    --dropdown-border-radius: #{$dropdown-border-radius};
    --dropdown-border-width: #{$dropdown-border-width};
    --dropdown-inner-border-radius: #{$dropdown-inner-border-radius};
    --dropdown-divider-bg: #{$dropdown-divider-bg};
    --dropdown-divider-margin-y: #{$dropdown-divider-margin-y};
    --dropdown-divider-margin-x: #{$dropdown-divider-margin-x};
    --dropdown-box-shadow: #{$dropdown-box-shadow};
    --dropdown-link-color: #{$dropdown-link-color};
    --dropdown-link-hover-color: #{$dropdown-link-hover-color};
    --dropdown-link-hover-bg: #{$dropdown-link-hover-bg};
    --dropdown-link-active-color: #{$dropdown-link-active-color};
    --dropdown-link-active-bg: #{$dropdown-link-active-bg};
    --dropdown-link-disabled-color: #{$dropdown-link-disabled-color};
    --dropdown-item-gap: #{$dropdown-item-gap};
    --dropdown-item-padding-x: #{$dropdown-item-padding-x};
    --dropdown-item-padding-y: #{$dropdown-item-padding-y};
    --dropdown-item-border-radius: #{$dropdown-item-border-radius};
    --dropdown-header-color: #{$dropdown-header-color};
    --dropdown-header-padding-x: #{$dropdown-header-padding-x};
    --dropdown-header-padding-y: #{$dropdown-header-padding-y};
    // scss-docs-end dropdown-css-vars

    position: absolute;
    z-index: var(--dropdown-zindex);
    display: none; // none by default, but flex on "open" of the menu
    flex-direction: column;
    gap: var(--dropdown-gap);
    min-width: var(--dropdown-min-width);
    padding: var(--dropdown-padding-y) var(--dropdown-padding-x);
    margin: 0; // Override default margin of ul
    font-size: var(--dropdown-font-size);
    color: var(--dropdown-color);
    text-align: start; // Ensures proper alignment if parent has it changed (e.g., modal footer)
    list-style: none;
    background-color: var(--dropdown-bg);
    background-clip: padding-box;
    border: var(--dropdown-border-width) solid var(--dropdown-border-color);
    @include border-radius(var(--dropdown-border-radius));
    @include box-shadow(var(--dropdown-box-shadow));

    @if $dropdown-padding-y == 0 {
      > .dropdown-item:first-child,
      > li:first-child .dropdown-item {
        @include border-top-radius(var(--dropdown-inner-border-radius));
      }
      > .dropdown-item:last-child,
      > li:last-child .dropdown-item {
        @include border-bottom-radius(var(--dropdown-inner-border-radius));
      }
    }
  }

  .dropdown-menu.show {
    display: flex;
  }

  // Dividers (basically an `<hr>`) within the dropdown
  .dropdown-divider {
    height: 0;
    margin: var(--dropdown-divider-margin-y) var(--dropdown-divider-margin-x);
    overflow: hidden;
    border-block-start: 1px solid var(--dropdown-divider-bg);
    opacity: 1;
  }

  // Links, buttons, and more within the dropdown menu
  //
  // `<button>`-specific styles are denoted with `// For <button>s`
  .dropdown-item {
    display: flex;
    gap: var(--dropdown-item-gap);
    align-items: center;
    width: 100%; // For `<button>`s
    padding: var(--dropdown-item-padding-y) var(--dropdown-item-padding-x);
    font-weight: $font-weight-normal;
    color: var(--dropdown-link-color);
    text-align: inherit; // For `<button>`s
    text-decoration: none;
    white-space: nowrap; // prevent links from randomly breaking onto new lines
    background-color: transparent; // For `<button>`s
    border: 0; // For `<button>`s
    @include border-radius(var(--dropdown-item-border-radius, 0));

    &:hover,
    &:focus {
      color: var(--dropdown-link-hover-color);
      @include gradient-bg(var(--dropdown-link-hover-bg));
    }

    &.active,
    &:active {
      color: var(--dropdown-link-active-color);
      @include gradient-bg(var(--dropdown-link-active-bg));
    }

    &.disabled,
    &:disabled {
      color: var(--dropdown-link-disabled-color);
      pointer-events: none;
      background-color: transparent;
      // Remove CSS gradients if they're enabled
      // stylelint-disable-next-line scss/at-function-named-arguments
      background-image: if(sass($enable-gradients): none; else: null);
    }
  }

  // Dropdown section headers
  .dropdown-header {
    display: block;
    padding: var(--dropdown-header-padding-y) var(--dropdown-header-padding-x);
    margin-bottom: 0; // for use with heading elements
    font-size: $font-size-sm;
    color: var(--dropdown-header-color);
    white-space: nowrap; // as with > li > a
  }

  // Dropdown text
  .dropdown-item-text {
    display: block;
    padding: var(--dropdown-item-padding-y) var(--dropdown-item-padding-x);
    color: var(--fg-2);
  }

  // Dark dropdowns
  .dropdown-menu-dark {
    // scss-docs-start dropdown-dark-css-vars
    --dropdown-color: #{$dropdown-dark-color};
    --dropdown-bg: #{$dropdown-dark-bg};
    --dropdown-border-color: #{$dropdown-dark-border-color};
    --dropdown-box-shadow: #{$dropdown-dark-box-shadow};
    --dropdown-link-color: #{$dropdown-dark-link-color};
    --dropdown-link-hover-color: #{$dropdown-dark-link-hover-color};
    --dropdown-divider-bg: #{$dropdown-dark-divider-bg};
    --dropdown-link-hover-bg: #{$dropdown-dark-link-hover-bg};
    --dropdown-link-active-color: #{$dropdown-dark-link-active-color};
    --dropdown-link-active-bg: #{$dropdown-dark-link-active-bg};
    --dropdown-link-disabled-color: #{$dropdown-dark-link-disabled-color};
    --dropdown-header-color: #{$dropdown-dark-header-color};
    // scss-docs-end dropdown-dark-css-vars
  }

  // scss-docs-start dropdown-submenu
  // Submenus
  //
  // Nested dropdown menus with hover/click activation and keyboard support.

  .dropdown-submenu {
    position: relative;

    // Submenu trigger styling
    > .dropdown-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    // Submenu caret indicator
    > .dropdown-item::after {
      display: inline-block;
      flex-shrink: 0;
      width: .375em;
      height: .375em;
      margin-inline-start: auto;
      content: "";
      border-color: currentcolor;
      border-style: solid;
      border-width: 0 .125em .125em 0;
      transform: rotate(-45deg);

      // RTL: flip the chevron direction
      [dir="rtl"] & {
        transform: rotate(135deg);
      }
    }

    // Submenu positioning (set by JS via Floating UI)
    > .dropdown-menu {
      top: 0;
      // Offset to align with parent item
      margin-top: calc(-1 * var(--dropdown-padding-y));
    }

    // Hover state for submenu trigger
    &:hover > .dropdown-item,
    &:focus-within > .dropdown-item {
      color: var(--dropdown-link-hover-color);
      background-color: var(--dropdown-link-hover-bg);
    }

    // Active/open state
    &.show > .dropdown-item {
      color: var(--dropdown-link-hover-color);
      background-color: var(--dropdown-link-hover-bg);
    }
  }

  // Mobile slide-over mode for submenus
  .dropdown-menu-mobile {
    --dropdown-mobile-header-height: 3rem;

    position: fixed !important; // stylelint-disable-line declaration-no-important
    inset: 0;
    z-index: calc(var(--dropdown-zindex) + 10);
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: none;
    height: 100%;
    max-height: 100dvh;
    padding-top: 0;
    overflow-y: auto;
    visibility: hidden;
    background-color: var(--dropdown-bg);
    border: 0;
    @include border-radius(0);
    opacity: 0;
    transform: translateX(100%);
    @include transition(transform .2s ease-out, opacity .2s ease-out, visibility .2s);

    [dir="rtl"] & {
      transform: translateX(-100%);
    }

    &.show {
      visibility: visible;
      opacity: 1;
      transform: translateX(0);
    }

    // Back button header for mobile submenus
    .dropdown-mobile-header {
      position: sticky;
      top: 0;
      z-index: 1;
      display: flex;
      gap: .5rem;
      align-items: center;
      min-height: var(--dropdown-mobile-header-height);
      padding: .5rem var(--dropdown-item-padding-x);
      font-weight: $font-weight-semibold;
      background-color: var(--dropdown-bg);
      border-bottom: var(--dropdown-border-width) solid var(--dropdown-border-color);
    }

    .dropdown-back-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 2rem;
      height: 2rem;
      padding: 0;
      color: var(--dropdown-link-color);
      cursor: pointer;
      background: transparent;
      border: 0;
      @include border-radius(var(--dropdown-item-border-radius));

      &:hover,
      &:focus {
        color: var(--dropdown-link-hover-color);
        background-color: var(--dropdown-link-hover-bg);
      }

      // Back arrow icon
      &::before {
        display: block;
        width: .5em;
        height: .5em;
        content: "";
        border-color: currentcolor;
        border-style: solid;
        border-width: .125em .125em 0 0;
        transform: rotate(-135deg);

        [dir="rtl"] & {
          transform: rotate(45deg);
        }
      }
    }
  }
  // scss-docs-end dropdown-submenu
}
