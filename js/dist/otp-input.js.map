{"version":3,"file":"otp-input.js","sources":["../src/otp-input.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Bootstrap otp-input.js\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport BaseComponent from './base-component.js'\nimport EventHandler from './dom/event-handler.js'\nimport SelectorEngine from './dom/selector-engine.js'\n\n/**\n * Constants\n */\n\nconst NAME = 'otpInput'\nconst DATA_KEY = 'bs.otp-input'\nconst EVENT_KEY = `.${DATA_KEY}`\nconst DATA_API_KEY = '.data-api'\n\nconst EVENT_COMPLETE = `complete${EVENT_KEY}`\nconst EVENT_INPUT = `input${EVENT_KEY}`\n\nconst SELECTOR_DATA_OTP = '[data-bs-otp]'\nconst SELECTOR_INPUT = 'input'\n\nconst Default = {\n  length: 6,\n  mask: false\n}\n\nconst DefaultType = {\n  length: 'number',\n  mask: 'boolean'\n}\n\n/**\n * Class definition\n */\n\nclass OtpInput extends BaseComponent {\n  constructor(element, config) {\n    super(element, config)\n\n    this._inputs = SelectorEngine.find(SELECTOR_INPUT, this._element)\n    this._setupInputs()\n    this._addEventListeners()\n  }\n\n  // Getters\n  static get Default() {\n    return Default\n  }\n\n  static get DefaultType() {\n    return DefaultType\n  }\n\n  static get NAME() {\n    return NAME\n  }\n\n  // Public\n  getValue() {\n    return this._inputs.map(input => input.value).join('')\n  }\n\n  setValue(value) {\n    const chars = String(value).split('')\n    for (const [index, input] of this._inputs.entries()) {\n      input.value = chars[index] || ''\n    }\n\n    this._checkComplete()\n  }\n\n  clear() {\n    for (const input of this._inputs) {\n      input.value = ''\n    }\n\n    this._inputs[0]?.focus()\n  }\n\n  focus() {\n    // Focus first empty input, or last input if all filled\n    const emptyInput = this._inputs.find(input => !input.value)\n    if (emptyInput) {\n      emptyInput.focus()\n    } else {\n      this._inputs.at(-1)?.focus()\n    }\n  }\n\n  // Private\n  _setupInputs() {\n    for (const input of this._inputs) {\n      // Set attributes for proper OTP handling\n      input.setAttribute('maxlength', '1')\n      input.setAttribute('inputmode', 'numeric')\n      input.setAttribute('pattern', '\\\\d*')\n\n      // First input gets autocomplete for browser OTP autofill\n      if (input === this._inputs[0]) {\n        input.setAttribute('autocomplete', 'one-time-code')\n      } else {\n        input.setAttribute('autocomplete', 'off')\n      }\n\n      // Mask input if configured\n      if (this._config.mask) {\n        input.setAttribute('type', 'password')\n      }\n    }\n  }\n\n  _addEventListeners() {\n    for (const [index, input] of this._inputs.entries()) {\n      EventHandler.on(input, 'input', event => this._handleInput(event, index))\n      EventHandler.on(input, 'keydown', event => this._handleKeydown(event, index))\n      EventHandler.on(input, 'paste', event => this._handlePaste(event))\n      EventHandler.on(input, 'focus', event => this._handleFocus(event))\n    }\n  }\n\n  _handleInput(event, index) {\n    const input = event.target\n\n    // Only allow digits\n    if (!/^\\d*$/.test(input.value)) {\n      input.value = input.value.replace(/\\D/g, '')\n    }\n\n    const { value } = input\n\n    // Handle multi-character input (some browsers/autofill)\n    if (value.length > 1) {\n      // Distribute characters across inputs\n      const chars = value.split('')\n      input.value = chars[0] || ''\n\n      for (let i = 1; i < chars.length && index + i < this._inputs.length; i++) {\n        this._inputs[index + i].value = chars[i]\n      }\n\n      // Focus appropriate input\n      const nextIndex = Math.min(index + chars.length, this._inputs.length - 1)\n      this._inputs[nextIndex].focus()\n    } else if (value && index < this._inputs.length - 1) {\n      // Auto-advance to next input\n      this._inputs[index + 1].focus()\n    }\n\n    EventHandler.trigger(this._element, EVENT_INPUT, {\n      value: this.getValue(),\n      index\n    })\n\n    this._checkComplete()\n  }\n\n  _handleKeydown(event, index) {\n    const { key } = event\n\n    switch (key) {\n      case 'Backspace': {\n        if (!this._inputs[index].value && index > 0) {\n          // Move to previous input and clear it\n          event.preventDefault()\n          this._inputs[index - 1].value = ''\n          this._inputs[index - 1].focus()\n        }\n\n        break\n      }\n\n      case 'Delete': {\n        // Clear current and shift remaining values left\n        event.preventDefault()\n        for (let i = index; i < this._inputs.length - 1; i++) {\n          this._inputs[i].value = this._inputs[i + 1].value\n        }\n\n        this._inputs.at(-1).value = ''\n        break\n      }\n\n      case 'ArrowLeft': {\n        if (index > 0) {\n          event.preventDefault()\n          this._inputs[index - 1].focus()\n        }\n\n        break\n      }\n\n      case 'ArrowRight': {\n        if (index < this._inputs.length - 1) {\n          event.preventDefault()\n          this._inputs[index + 1].focus()\n        }\n\n        break\n      }\n\n      // No default\n    }\n  }\n\n  _handlePaste(event) {\n    event.preventDefault()\n    const pastedData = (event.clipboardData || window.clipboardData).getData('text')\n    const digits = pastedData.replace(/\\D/g, '').slice(0, this._inputs.length)\n\n    if (digits) {\n      this.setValue(digits)\n\n      // Focus last filled input or last input\n      const lastIndex = Math.min(digits.length, this._inputs.length) - 1\n      this._inputs[lastIndex].focus()\n    }\n  }\n\n  _handleFocus(event) {\n    // Select the content on focus for easy replacement\n    event.target.select()\n  }\n\n  _checkComplete() {\n    const value = this.getValue()\n    const isComplete = value.length === this._inputs.length &&\n      this._inputs.every(input => input.value !== '')\n\n    if (isComplete) {\n      EventHandler.trigger(this._element, EVENT_COMPLETE, { value })\n    }\n  }\n}\n\n/**\n * Data API implementation\n */\n\nEventHandler.on(document, `DOMContentLoaded${EVENT_KEY}${DATA_API_KEY}`, () => {\n  for (const element of SelectorEngine.find(SELECTOR_DATA_OTP)) {\n    OtpInput.getOrCreateInstance(element)\n  }\n})\n\nexport default OtpInput\n"],"names":["NAME","DATA_KEY","EVENT_KEY","DATA_API_KEY","EVENT_COMPLETE","EVENT_INPUT","SELECTOR_DATA_OTP","SELECTOR_INPUT","Default","length","mask","DefaultType","OtpInput","BaseComponent","constructor","element","config","_inputs","SelectorEngine","find","_element","_setupInputs","_addEventListeners","getValue","map","input","value","join","setValue","chars","String","split","index","entries","_checkComplete","clear","focus","emptyInput","at","setAttribute","_config","EventHandler","on","event","_handleInput","_handleKeydown","_handlePaste","_handleFocus","target","test","replace","i","nextIndex","Math","min","trigger","key","preventDefault","pastedData","clipboardData","window","getData","digits","slice","lastIndex","select","isComplete","every","document","getOrCreateInstance"],"mappings":"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"}